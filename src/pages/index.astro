---
import { getCollection } from 'astro:content';

import { getTitleFromPost } from '../util.astro';
import Main from '../layouts/Main.astro';
import ContentCard from '../components/ContentCard.astro';

const posts = (await getCollection('posts')).sort((a, b) =>
  // newest -> oldest
  b.data.published.valueOf() - a.data.published.valueOf())
---

<Main title="Home">
  {await Promise.all(
    posts.map(async (post) => {
      const title = post.data.title ?? await getTitleFromPost(post);
      return (
        <ContentCard
          type="posts"
          id={post.id}
          title={title}
          date={post.data.published}
          tags={post.data.tags}
        />
      );
    })
  )}
</Main>

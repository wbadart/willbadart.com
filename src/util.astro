---
import type { MarkdownHeading } from 'astro';
import { type CollectionEntry, type CollectionKey, render } from 'astro:content';

export const getTitleFromPost = async (post: CollectionEntry<CollectionKey>): Promise<string> => {
  const { headings } = await render(post);
  return getTitleFromHeadings(headings);
}

export const getTitleFromHeadings = (headings: MarkdownHeading[]): string =>
  headings.find(h => h.depth === 1)?.text ?? '';

type Neighbors<T> = {
  current: T,
  prev: T | undefined,
  next: T | undefined,
}

export const withNeighbors = <T,>(a: T[]): Neighbors<T>[] =>
  a.map((current, index, orig) => ({
    current,
    // reverse signs for reverse chronological sorting
    prev: orig?.[index + 1],
    next: orig?.[index - 1],
  }));
---
